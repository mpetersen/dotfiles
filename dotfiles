#!/bin/bash
# .dotfiles installation script for Mac OS X

dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

function help {
    bold=$(tput bold)
    normal=$(tput sgr0)

    cat << EOF
dotfiles organizes your Mac OS X dotfiles

usage: dotfiles [<flag>] <command>

Available flags are:
  --filevault   Enables FileVault when used in combination with the setup
                command

Available commands are:
  help          Prints this help text
  setup         Sets up dotfiles and the environment on the current system.
                This should be usually called only once
  update        Updates the dotfiles and the environment setup
  unlink        Unlinks the dotfiles so you can safely remove the .dotfiles
                repository


Copyright 2015 by Moritz Petersen


EOF
}

function setup {
    # Install developer tools
    xcode-select --install &> /dev/null

    # Install Homebrew
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

    # Install Homebrew Cask
    brew install caskroom/cask/brew-cask

    # Install Homebrew Versions
    brew tap homebrew/versions

    # Install Homebrew Fonts
    brew tap caskroom/fonts

    update
}

function update {
    echo ">> ${FUNCNAME[0]}"
    local installers=( brew brew-cask brew-fonts atom safari )

    for i in "${installers[@]}"; do
        $dir/install/$i.sh
    done
}

function unlink {
    echo ">> ${FUNCNAME[0]}"
}

flags=( filevault )
commands=( help setup update unlink )

command=help
for arg in $@; do
    for f in "${flags[@]}"; do
        if [ "$arg" = "--$f" ]; then
            declare enable_$f=true
        fi
    done
    for c in "${commands[@]}"; do
        if [ "$arg" = "$c" ]; then
            command=$c
        fi
    done
done

$command
